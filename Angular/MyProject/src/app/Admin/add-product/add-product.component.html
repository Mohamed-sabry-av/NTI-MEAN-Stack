<main class="main-content">
    <section class="content">
      <h1 class="section-title">Add New Product</h1>
      <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
        <!-- General Information -->
        <div class="form-section">
          <h2>General Information</h2>
          <label>
            <span>Name Product</span>
            <input formControlName="name" type="text" placeholder="Enter product name">
            <div *ngIf="name?.invalid && name?.touched" class="error">
              <span *ngIf="name?.errors?.['required']">Product name is required.</span>
              <span *ngIf="name?.errors?.['minlength']">Name must be at least 3 characters long.</span>
            </div>
          </label>
          <label>
            <span>Description Product</span>
            <textarea formControlName="description" rows="4" placeholder="Enter product description"></textarea>
            <div *ngIf="description?.invalid && description?.touched" class="error">
              <span *ngIf="description?.errors?.['required']">Description is required.</span>
              <span *ngIf="description?.errors?.['minlength']">Description must be at least 10 characters long.</span>
            </div>
          </label>
        </div>

        <!-- Product Details -->
        <div class="form-section">
          <h2>Product Details</h2>
          <div class="input-group">
            <label>
              <span>Size</span>
              <div class="size-options">
                <button
                  type="button"
                  class="size-btn"
                  *ngFor="let size of sizes"
                  [ngClass]="{ active: selectedSize === size }"
                  (click)="selectSize(size)"
                >
                  {{ size }}
                </button>
              </div>
            </label>
            <label>
              <span>Color</span>
              <input formControlName="color" type="text" placeholder="Enter color">
              <div *ngIf="color?.invalid && color?.touched" class="error">
                <span *ngIf="color?.errors?.['required']">Color is required.</span>
              </div>
            </label>
            <label>
              <span>Brand</span>
              <input formControlName="brand" type="text" placeholder="Enter brand">
              <div *ngIf="brand?.invalid && brand?.touched" class="error">
                <span *ngIf="brand?.errors?.['required']">Brand is required.</span>
              </div>
            </label>
          </div>
        </div>

        <!-- Pricing and Stock -->
        <div class="form-section">
          <h2>Pricing And Stock</h2>
          <div class="input-group">
            <label>
              <span>Base Pricing</span>
              <input formControlName="price" type="number" placeholder="Enter price">
              <div *ngIf="price?.invalid && price?.touched" class="error">
                <span *ngIf="price?.errors?.['required']">Price is required.</span>
                <span *ngIf="price?.errors?.['min']">Price must be greater than 0.</span>
              </div>
            </label>
            <label>
              <span>Stock</span>
              <input formControlName="amount" type="number" placeholder="Enter stock">
              <div *ngIf="amount?.invalid && amount?.touched" class="error">
                <span *ngIf="amount?.errors?.['required']">Stock is required.</span>
                <span *ngIf="amount?.errors?.['min']">Stock must be greater than or equal to 0.</span>
              </div>
            </label>
          </div>
        </div>

        <!-- Image Upload -->
        <div class="form-section">
          <h2>Upload Image</h2>
          <div class="image-upload">
            <input type="file" (change)="onImageSelect($event)">
            <img *ngIf="imagePreview" [src]="imagePreview" alt="Image Preview" class="image-preview">
          </div>
        </div>

       
        <!-- Category and Subcategory -->
        <div class="form-section">
          <h2>Category</h2>
          <div class="input-group category-group">
            <label *ngIf="!isAddingCategory">
              <span>Product Category</span>
              <select formControlName="category" class="category-select" (change)="getSubcategories()">
                <option *ngFor="let c of categories" [value]="c._id">{{ c.name }}</option>
              </select>
            </label>

            <!-- Input field for adding a new category -->
            <label *ngIf="isAddingCategory">
              <span>New Category Name</span>
              <input formControlName="newCategoryName" type="text" placeholder="Enter category name">
            </label>

            <!-- Toggle Add Category/Input -->
            <button type="button" class="btn-secondary" (click)="toggleAddCategory()">
              {{ isAddingCategory ? 'Cancel' : 'Add Category' }}
            </button>

            <!-- Save New Category Button -->
            <button
              *ngIf="isAddingCategory"
              type="button"
              class="btn-primary btn-small"
              (click)="saveCategory()"
            >
              Save
            </button>
          </div>
          <div class="input-group subcategory-group">
            <label *ngIf="!isAddingSubcategory">
              <span>Sub-Category</span>
              <select formControlName="subcategory" class="subcategory-select">
                <option *ngFor="let s of subcategories" [value]="s._id">{{ s.name }}</option>
              </select>
            </label>

            <!-- Input field for adding a new category -->
            <label *ngIf="isAddingSubcategory">
              <span>New Subcategory Name</span>
              <input formControlName="newSubcategoryName" type="text" placeholder="Enter subcategory name">
            </label>

            <!-- Toggle Add Category/Input -->
            <button type="button" class="btn-secondary" (click)="toggleAddSubcategory()">
              {{ isAddingSubcategory ? 'Cancel' : 'Add Subcategory' }}
            </button>

            <!-- Save New Category Button -->
            <button
              *ngIf="isAddingSubcategory"
              type="button"
              class="btn-primary btn-small"
              (click)="saveSubcategory()"
            >
              Save
            </button>
          </div>
  
        </div>
        <!-- Pin to Home -->
        <div class="form-section">
          <h2>Pin to Home</h2>
          <label>
            <input formControlName="pinToHome" type="checkbox">
            <span>Pin this product to the homepage</span>
          </label>
        </div>

        <!-- Action Buttons -->
        <div class="form-actions">
          <button type="submit" class="btn-primary" [disabled]="productForm.invalid">Add Product</button>
        </div>
      </form>
    </section>
  </main>